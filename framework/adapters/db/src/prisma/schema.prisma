generator client {
  provider = "prisma-client-js"
}

generator kysely {
  provider = "prisma-kysely"
  output   = "../../generated/kysely"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["core", "mdm", "meta", "public", "ref", "ui"]
}

model Tenant {
  id                              String                            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code                            String                            @unique
  name                            String
  display_name                    String
  realm_key                       String                            @default("main")
  status                          String                            @default("active")
  region                          String?
  subscription                    String                            @default("base")
  createdAt                       DateTime                          @default(now()) @map("created_at") @db.Timestamptz(6)
  createdBy                       String                            @map("created_by")
  updatedAt                       DateTime?                         @map("updated_at") @db.Timestamptz(6)
  updatedBy                       String?                           @map("updated_by")
  address                         address[]
  address_link                    address_link[]
  approval_comment                approval_comment[]
  approval_definition             approval_definition[]
  approval_instance               approval_instance[]
  approval_task                   approval_task[]
  attachment                      attachment[]
  audit_log                       audit_log[]
  contact_phone                   contact_phone[]
  contact_point                   contact_point[]
  document                        document[]
  email_otp_instance              email_otp_instance[]
  entitlement                     entitlement[]
  entity_tag                      entity_tag[]
  feature_flag                    feature_flag[]
  field_access_log                field_access_log[]
  groupMembers                    GroupMember[]
  idpIdentities                   IdpIdentity[]
  job                             job[]
  job_run                         job_run[]
  lifecycle                       core_lifecycle[]
  lifecycle_version               lifecycle_version[]
  mfa_challenge                   mfa_challenge[]
  mfa_config                      mfa_config[]
  organizational_unit             organizational_unit[]
  outbox                          outbox[]
  password_history                password_history[]
  permission_decision_log         PermissionDecisionLog[]
  principals                      Principal[]
  principal_group                 principal_group[]
  principal_locale_override       principal_locale_override[]
  principal_ou                    principal_ou[]
  principalProfiles               PrincipalProfile[]
  principal_role                  principal_role[]
  principal_workspace_access      principal_workspace_access[]
  roles                           Role[]
  security_event                  security_event[]
  sms_otp_instance                sms_otp_instance[]
  system_config                   system_config[]
  tenant_locale_policy            tenant_locale_policy[]
  tenant_module_subscription      tenant_module_subscription[]
  tenantProfile                   TenantProfile?
  totp_instance                   totp_instance[]
  trusted_device                  trusted_device[]
  webauthn_credential             webauthn_credential[]
  workflow_instance               workflow_instance[]
  workflow_transition             workflow_transition[]
  workspace_feature               workspace_feature[]
  workspace_usage_metric          workspace_usage_metric[]
  approval_sla_policy             approval_sla_policy[]
  approval_template               approval_template[]
  approval_template_rule          approval_template_rule[]
  approval_template_stage         approval_template_stage[]
  entity                          entity[]
  entity_compiled                 entity_compiled[]
  entity_compiled_overlay         entity_compiled_overlay[]
  entity_lifecycle                entity_lifecycle[]
  entity_lifecycle_route_compiled entity_lifecycle_route_compiled[]
  entity_policy                   entity_policy[]
  entity_version                  entity_version[]
  field                           field[]
  field_security_policy           field_security_policy[]
  index_def                       index_def[]
  meta_lifecycle                  meta_lifecycle[]
  lifecycle_state                 lifecycle_state[]
  lifecycle_timer_policy          lifecycle_timer_policy[]
  lifecycle_transition            lifecycle_transition[]
  lifecycle_transition_gate       lifecycle_transition_gate[]
  overlay                         overlay[]
  overlay_change                  overlay_change[]
  permission_policy               PermissionPolicy[]
  permission_policy_compiled      PermissionPolicyCompiled[]
  permission_policy_version       PermissionPolicyVersion[]
  permission_rule                 PermissionRule[]
  permission_rule_operation       PermissionRuleOperation[]
  relation                        relation[]
  dashboard_widget                dashboard_widget[]
  notification                    notification[]
  notification_preference         notification_preference[]
  recent_activity                 recent_activity[]
  saved_view                      saved_view[]
  search_history                  search_history[]
  user_preference                 user_preference[]

  @@index([realm_key], map: "idx_tenant_realm_key")
  @@map("tenant")
  @@schema("core")
}

/// B1: Principal - Canonical athyper actor (user/service/external)
model Principal {
  id                                                          String                       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenantId                                                    String                       @map("tenant_id") @db.Uuid
  realm_key                                                   String                       @default("main")
  principalType                                               String                       @map("principal_type")
  principal_code                                              String                       @unique
  displayName                                                 String?                      @map("display_name")
  email                                                       String?
  phone                                                       String?
  given_name                                                  String?
  family_name                                                 String?
  preferred_name                                              String?
  external_id                                                 String?
  subject_id                                                  String?
  is_active                                                   Boolean                      @default(true)
  is_service_account                                          Boolean                      @default(false)
  is_locked                                                   Boolean                      @default(false)
  password_hash                                               String?
  password_updated_at                                         DateTime?                    @db.Timestamptz(6)
  last_login_at                                               DateTime?                    @db.Timestamptz(6)
  last_login_ip                                               String?
  idp_display_name                                            String?
  idp_family_name                                             String?
  idp_given_name                                              String?
  idp_email                                                   String?
  idp_email_verified                                          Boolean?
  idp_phone_number                                            String?
  idp_phone_verified                                          Boolean?
  idp_picture                                                 String?
  idp_locale                                                  String?
  idp_timezone                                                String?
  createdAt                                                   DateTime                     @default(now()) @map("created_at") @db.Timestamptz(6)
  createdBy                                                   String                       @map("created_by")
  updated_at                                                  DateTime?                    @db.Timestamptz(6)
  updated_by                                                  String?
  approval_comment                                            approval_comment[]
  approval_instance_approval_instance_decided_byToprincipal   approval_instance[]          @relation("approval_instance_decided_byToprincipal")
  approval_instance_approval_instance_requested_byToprincipal approval_instance[]          @relation("approval_instance_requested_byToprincipal")
  approval_task                                               approval_task[]
  entitlement                                                 entitlement[]
  groupMemberships                                            GroupMember[]
  idpIdentities                                               IdpIdentity[]
  mfa_challenge                                               mfa_challenge[]
  mfa_config                                                  mfa_config[]
  password_history                                            password_history[]
  tenant                                                      Tenant                       @relation(fields: [tenantId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  principal_locale_override                                   principal_locale_override?
  principal_ou                                                principal_ou[]
  profile                                                     PrincipalProfile?
  principal_role                                              principal_role[]
  principal_workspace_access                                  principal_workspace_access[]
  security_event                                              security_event[]
  trusted_device                                              trusted_device[]
  workflow_instance_workflow_instance_completed_byToprincipal workflow_instance[]          @relation("workflow_instance_completed_byToprincipal")
  workflow_instance_workflow_instance_initiated_byToprincipal workflow_instance[]          @relation("workflow_instance_initiated_byToprincipal")
  workflow_transition                                         workflow_transition[]
  dashboard_widget                                            dashboard_widget[]
  notification_notification_recipient_idToprincipal           notification[]               @relation("notification_recipient_idToprincipal")
  notification_notification_sender_idToprincipal              notification[]               @relation("notification_sender_idToprincipal")
  notification_preference                                     notification_preference[]
  recent_activity                                             recent_activity[]
  saved_view                                                  saved_view[]
  search_history                                              search_history[]
  user_preference                                             user_preference[]

  @@unique([tenantId, external_id], map: "principal_tenant_external_uniq")
  @@index([principal_code], map: "idx_principal_code")
  @@index([tenantId, email], map: "idx_principal_email")
  @@index([tenantId, external_id], map: "idx_principal_external_id")
  @@index([tenantId, principalType], map: "idx_principal_tenant_type")
  @@map("principal")
  @@schema("core")
}

/// B1: IdP Identity - Maps external IdP (realm/provider/subject) to principal
model IdpIdentity {
  id                       String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenantId                 String    @map("tenant_id") @db.Uuid
  principalId              String    @map("principal_id") @db.Uuid
  idp_name                 String
  idp_subject              String
  access_token             String?
  access_token_expires_at  DateTime? @db.Timestamptz(6)
  refresh_token            String?
  refresh_token_expires_at DateTime? @db.Timestamptz(6)
  id_token                 String?
  id_token_expires_at      DateTime? @db.Timestamptz(6)
  token_type               String?
  scope                    String?
  last_refreshed_at        DateTime? @db.Timestamptz(6)
  last_authenticated_at    DateTime? @db.Timestamptz(6)
  raw_claims               Json?
  createdAt                DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  createdBy                String    @map("created_by")
  updated_at               DateTime? @db.Timestamptz(6)
  updated_by               String?
  principal                Principal @relation(fields: [principalId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenant                   Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([tenantId, idp_name, idp_subject], map: "idp_identity_tenant_idp_subject_uniq")
  @@index([tenantId, idp_name, idp_subject], map: "idx_idp_identity_idp_subject")
  @@index([tenantId, principalId], map: "idx_idp_identity_principal")
  @@map("idp_identity")
  @@schema("core")
}

/// B1: Principal Profile - Extended profile attributes
model PrincipalProfile {
  id                         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenantId                   String    @map("tenant_id") @db.Uuid
  principalId                String    @unique(map: "principal_profile_principal_uniq") @map("principal_id") @db.Uuid
  first_name                 String?
  last_name                  String?
  locale                     String?
  timezone                   String?
  keycloak_id                String?
  keycloak_created_at_millis BigInt?
  keycloak_federation_link   String?
  attributes                 Json?
  enabled_date               DateTime? @db.Timestamptz(6)
  disabled_date              DateTime? @db.Timestamptz(6)
  createdAt                  DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  createdBy                  String    @map("created_by")
  updatedAt                  DateTime? @map("updated_at") @db.Timestamptz(6)
  updatedBy                  String?   @map("updated_by")
  principal                  Principal @relation(fields: [principalId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenant                     Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([tenantId, keycloak_id], map: "idx_principal_profile_keycloak_id")
  @@index([tenantId], map: "idx_principal_profile_tenant")
  @@map("principal_profile")
  @@schema("core")
}

/// B2: Tenant Profile - Tenant operational defaults
model TenantProfile {
  id                   String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenantId             String    @unique @map("tenant_id") @db.Uuid
  country              String?
  currency             String?
  locale               String?
  timezone             String?
  fiscalYearStartMonth Int?      @map("fiscal_year_start_month")
  metadata             Json?
  createdAt            DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  createdBy            String    @map("created_by")
  updatedAt            DateTime? @map("updated_at") @db.Timestamptz(6)
  updatedBy            String?   @map("updated_by")
  tenant               Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([tenantId], map: "idx_tenant_profile_tenant")
  @@map("tenant_profile")
  @@schema("core")
}

/// B3: Group Member - Group membership with optional validity period
model GroupMember {
  id          String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenantId    String          @map("tenant_id") @db.Uuid
  groupId     String          @map("group_id") @db.Uuid
  principalId String          @map("principal_id") @db.Uuid
  joined_at   DateTime        @default(now()) @db.Timestamptz(6)
  group       principal_group @relation(fields: [groupId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  principal   Principal       @relation(fields: [principalId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenant      Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([groupId, principalId], map: "group_member_gp_princ_uniq")
  @@index([tenantId, principalId], map: "idx_group_member_principal")
  @@map("group_member")
  @@schema("core")
}

/// B4: Role - Role definitions with scope mode
model Role {
  id                         String                       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenantId                   String                       @map("tenant_id") @db.Uuid
  code                       String
  name                       String
  description                String?
  category                   String?
  metadata                   Json?
  createdAt                  DateTime                     @default(now()) @map("created_at") @db.Timestamptz(6)
  createdBy                  String                       @map("created_by")
  updated_at                 DateTime?                    @db.Timestamptz(6)
  updated_by                 String?
  entitlement                entitlement[]
  principal_role             principal_role[]
  principal_workspace_access principal_workspace_access[]
  tenant                     Tenant                       @relation(fields: [tenantId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([tenantId, code], map: "role_tenant_code_uniq")
  @@index([tenantId, category], map: "idx_role_category")
  @@index([tenantId], map: "idx_role_tenant")
  @@map("role")
  @@schema("core")
}

/// Permission policy container
model PermissionPolicy {
  id          String                    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenantId    String                    @map("tenant_id") @db.Uuid
  name        String
  description String?
  scopeType   String                    @map("scope_type")
  scopeKey    String?                   @map("scope_key")
  sourceType  String                    @default("system") @map("source_type")
  sourceRef   String?                   @map("source_ref")
  isActive    Boolean                   @default(true) @map("is_active")
  createdAt   DateTime                  @default(now()) @map("created_at") @db.Timestamptz(6)
  createdBy   String                    @map("created_by")
  updatedAt   DateTime?                 @map("updated_at") @db.Timestamptz(6)
  updatedBy   String?                   @map("updated_by")
  tenant      Tenant                    @relation(fields: [tenantId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  versions    PermissionPolicyVersion[]

  @@unique([tenantId, name], map: "permission_policy_name_uniq")
  @@map("permission_policy")
  @@schema("meta")
}

/// Permission policy version (draft/published/archived)
model PermissionPolicyVersion {
  id               String                     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenantId         String                     @map("tenant_id") @db.Uuid
  policyId         String                     @map("permission_policy_id") @db.Uuid
  versionNo        Int                        @default(1) @map("version_no")
  status           String                     @default("draft")
  publishedAt      DateTime?                  @map("published_at") @db.Timestamptz(6)
  publishedBy      String?                    @map("published_by")
  createdAt        DateTime                   @default(now()) @map("created_at") @db.Timestamptz(6)
  createdBy        String                     @map("created_by")
  compiledPolicies PermissionPolicyCompiled[]
  policy           PermissionPolicy           @relation(fields: [policyId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenant           Tenant                     @relation(fields: [tenantId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  rules            PermissionRule[]

  @@unique([tenantId, policyId, versionNo], map: "policy_version_uniq")
  @@map("permission_policy_version")
  @@schema("meta")
}

/// Permission rule (subject + scope + operations + conditions + effect)
model PermissionRule {
  id              String                    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenantId        String                    @map("tenant_id") @db.Uuid
  policyVersionId String                    @map("policy_version_id") @db.Uuid
  scopeType       String                    @map("scope_type")
  scopeKey        String?                   @map("scope_key")
  subjectType     String                    @map("subject_type")
  subjectKey      String                    @map("subject_key")
  effect          String
  conditions      Json?
  priority        Int                       @default(100)
  isActive        Boolean                   @default(true) @map("is_active")
  comment         String?
  createdAt       DateTime                  @default(now()) @map("created_at") @db.Timestamptz(6)
  createdBy       String                    @map("created_by")
  policyVersion   PermissionPolicyVersion   @relation(fields: [policyVersionId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenant          Tenant                    @relation(fields: [tenantId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  operations      PermissionRuleOperation[]

  @@index([tenantId, policyVersionId, scopeType, scopeKey, subjectType, subjectKey, priority], map: "idx_permission_rule_lookup")
  @@map("permission_rule")
  @@schema("meta")
}

/// Permission rule operation mapping
model PermissionRuleOperation {
  id                   String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenantId             String         @map("tenant_id") @db.Uuid
  ruleId               String         @map("permission_rule_id") @db.Uuid
  operationId          String         @map("operation_id") @db.Uuid
  operationConstraints Json?          @map("operation_constraints")
  createdAt            DateTime       @default(now()) @map("created_at") @db.Timestamptz(6)
  createdBy            String         @map("created_by")
  operation            operation      @relation(fields: [operationId], references: [id], onUpdate: NoAction)
  rule                 PermissionRule @relation(fields: [ruleId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenant               Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([tenantId, ruleId, operationId], map: "rule_operation_uniq")
  @@index([tenantId, operationId], map: "idx_rule_operation_op")
  @@map("permission_rule_operation")
  @@schema("meta")
}

/// Compiled policy snapshot for fast evaluation
model PermissionPolicyCompiled {
  id              String                  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenantId        String                  @map("tenant_id") @db.Uuid
  policyVersionId String                  @map("policy_version_id") @db.Uuid
  compiledJson    Json                    @map("compiled_json")
  compiledHash    String                  @map("compiled_hash")
  generatedAt     DateTime                @default(now()) @map("generated_at") @db.Timestamptz(6)
  createdAt       DateTime                @default(now()) @map("created_at") @db.Timestamptz(6)
  createdBy       String                  @map("created_by")
  policyVersion   PermissionPolicyVersion @relation(fields: [policyVersionId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenant          Tenant                  @relation(fields: [tenantId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([tenantId, policyVersionId, compiledHash], map: "policy_compiled_hash_uniq")
  @@map("permission_policy_compiled")
  @@schema("meta")
}

/// Permission decision log (audit trail for all access decisions)
model PermissionDecisionLog {
  id                     String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenantId               String   @map("tenant_id") @db.Uuid
  occurredAt             DateTime @default(now()) @map("occurred_at") @db.Timestamptz(6)
  actorPrincipalId       String?  @map("actor_principal_id") @db.Uuid
  subjectSnapshot        Json?    @map("subject_snapshot")
  entityName             String?  @map("entity_name")
  entityId               String?  @map("entity_id")
  entityVersionId        String?  @map("entity_version_id") @db.Uuid
  operationCode          String   @map("operation_code")
  effect                 String
  matchedRuleId          String?  @map("matched_rule_id") @db.Uuid
  matchedPolicyVersionId String?  @map("matched_policy_version_id") @db.Uuid
  reason                 String?
  correlationId          String?  @map("correlation_id")
  tenant                 Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([tenantId, occurredAt(sort: Desc)], map: "idx_decision_log_tenant_time")
  @@map("permission_decision_log")
  @@schema("core")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model address {
  id           String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id    String         @db.Uuid
  country_code String?
  line1        String?
  line2        String?
  city         String?
  region       String?
  postal_code  String?
  metadata     Json?
  created_at   DateTime       @default(now()) @db.Timestamptz(6)
  created_by   String
  tenant       Tenant         @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  address_link address_link[]

  @@unique([tenant_id, id], map: "address_tenant_id_id_uq")
  @@index([tenant_id], map: "idx_address_tenant")
  @@schema("core")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model address_link {
  id              String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id       String    @db.Uuid
  owner_type      String
  owner_id        String    @db.Uuid
  address_id      String    @db.Uuid
  purpose         String
  priority        Int       @default(0)
  is_primary      Boolean   @default(false)
  effective_from  DateTime  @default(now()) @db.Timestamptz(6)
  effective_until DateTime? @db.Timestamptz(6)
  metadata        Json?
  created_at      DateTime  @default(now()) @db.Timestamptz(6)
  created_by      String
  updated_at      DateTime? @db.Timestamptz(6)
  updated_by      String?
  address         address   @relation(fields: [address_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenant          Tenant    @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([tenant_id, owner_type, owner_id, purpose, address_id], map: "address_link_owner_purpose_address_uniq")
  @@index([address_id], map: "idx_address_link_address")
  @@index([tenant_id, owner_type, owner_id], map: "idx_address_link_owner")
  @@index([tenant_id, purpose], map: "idx_address_link_purpose")
  @@schema("core")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model approval_comment {
  id                   String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id            String            @db.Uuid
  approval_instance_id String            @db.Uuid
  approval_task_id     String?           @db.Uuid
  commenter_id         String            @db.Uuid
  comment_text         String
  created_at           DateTime          @default(now()) @db.Timestamptz(6)
  created_by           String
  approval_instance    approval_instance @relation(fields: [approval_instance_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  approval_task        approval_task?    @relation(fields: [approval_task_id], references: [id], onUpdate: NoAction)
  principal            Principal         @relation(fields: [commenter_id], references: [id], onDelete: SetNull, onUpdate: NoAction)
  tenant               Tenant            @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([commenter_id, created_at(sort: Desc)], map: "idx_approval_comment_commenter")
  @@index([approval_instance_id, created_at], map: "idx_approval_comment_instance")
  @@schema("core")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model approval_definition {
  id                String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id         String              @db.Uuid
  code              String
  name              String
  description       String?
  entity_type       String
  rules             Json                @default("{\"approvers\": [], \"conditions\": []}")
  is_active         Boolean             @default(true)
  created_at        DateTime            @default(now()) @db.Timestamptz(6)
  created_by        String
  updated_at        DateTime?           @db.Timestamptz(6)
  updated_by        String?
  tenant            Tenant              @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  approval_instance approval_instance[]

  @@unique([tenant_id, code], map: "approval_definition_tenant_code_uniq")
  @@index([tenant_id, entity_type], map: "idx_approval_definition_entity_type")
  @@index([tenant_id], map: "idx_approval_definition_tenant")
  @@schema("core")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model approval_instance {
  id                                                  String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id                                           String              @db.Uuid
  approval_definition_id                              String              @db.Uuid
  entity_type                                         String
  entity_id                                           String              @db.Uuid
  entity_version_id                                   String?             @db.Uuid
  entity_snapshot                                     Json?
  status                                              String              @default("pending")
  decision                                            String?
  requested_by                                        String              @db.Uuid
  requested_at                                        DateTime            @default(now()) @db.Timestamptz(6)
  decided_by                                          String?             @db.Uuid
  decided_at                                          DateTime?           @db.Timestamptz(6)
  reason                                              String?
  metadata                                            Json?
  created_at                                          DateTime            @default(now()) @db.Timestamptz(6)
  created_by                                          String
  updated_at                                          DateTime?           @db.Timestamptz(6)
  updated_by                                          String?
  approval_comment                                    approval_comment[]
  approval_definition                                 approval_definition @relation(fields: [approval_definition_id], references: [id], onUpdate: NoAction)
  principal_approval_instance_decided_byToprincipal   Principal?          @relation("approval_instance_decided_byToprincipal", fields: [decided_by], references: [id], onUpdate: NoAction)
  principal_approval_instance_requested_byToprincipal Principal           @relation("approval_instance_requested_byToprincipal", fields: [requested_by], references: [id], onDelete: SetNull, onUpdate: NoAction)
  tenant                                              Tenant              @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  approval_task                                       approval_task[]

  @@index([tenant_id, entity_type, entity_id], map: "idx_approval_instance_entity")
  @@index([requested_by, requested_at(sort: Desc)], map: "idx_approval_instance_requested_by")
  @@index([tenant_id, status], map: "idx_approval_instance_status")
  @@schema("core")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model approval_task {
  id                   String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id            String             @db.Uuid
  approval_instance_id String             @db.Uuid
  approver_id          String             @db.Uuid
  order_index          Int
  status               String             @default("pending")
  assigned_at          DateTime           @default(now()) @db.Timestamptz(6)
  started_at           DateTime?          @db.Timestamptz(6)
  completed_at         DateTime?          @db.Timestamptz(6)
  decision             String?
  reason               String?
  metadata             Json?
  created_at           DateTime           @default(now()) @db.Timestamptz(6)
  created_by           String
  updated_at           DateTime?          @db.Timestamptz(6)
  updated_by           String?
  approval_comment     approval_comment[]
  approval_instance    approval_instance  @relation(fields: [approval_instance_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  principal            Principal          @relation(fields: [approver_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenant               Tenant             @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([approver_id, status], map: "idx_approval_task_approver")
  @@index([approval_instance_id, order_index], map: "idx_approval_task_instance")
  @@index([tenant_id, status], map: "idx_approval_task_status")
  @@schema("core")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model attachment {
  id               String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id        String    @db.Uuid
  owner_entity     String?
  owner_entity_id  String?
  file_name        String
  content_type     String?
  size_bytes       BigInt?
  storage_bucket   String
  storage_key      String
  is_virus_scanned Boolean   @default(false)
  retention_until  DateTime? @db.Timestamptz(6)
  metadata         Json?
  created_at       DateTime  @default(now()) @db.Timestamptz(6)
  created_by       String
  tenant           Tenant    @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([tenant_id, owner_entity, owner_entity_id], map: "idx_attachment_owner")
  @@schema("core")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model audit_log {
  id                String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id         String   @db.Uuid
  occurred_at       DateTime @default(now()) @db.Timestamptz(6)
  actor_id          String?  @db.Uuid
  actor_type        String
  action            String
  entity_name       String?
  entity_id         String?
  entity_version_id String?  @db.Uuid
  correlation_id    String?
  ip_address        String?
  user_agent        String?
  payload           Json?
  tenant            Tenant   @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([tenant_id, occurred_at(sort: Desc)], map: "idx_audit_log_tenant_time")
  @@schema("core")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model contact_phone {
  id               String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id        String        @db.Uuid
  contact_point_id String        @db.Uuid
  e164             String?
  country_code     String?
  national_number  String?
  carrier_hint     String?
  created_at       DateTime      @default(now()) @db.Timestamptz(6)
  created_by       String
  contact_point    contact_point @relation(fields: [contact_point_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenant           Tenant        @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@schema("core")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model contact_point {
  id            String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id     String          @db.Uuid
  owner_type    String
  owner_id      String          @db.Uuid
  channel_type  String
  value         String
  purpose       String?
  is_primary    Boolean         @default(false)
  is_verified   Boolean         @default(false)
  metadata      Json?
  created_at    DateTime        @default(now()) @db.Timestamptz(6)
  created_by    String
  contact_phone contact_phone[]
  tenant        Tenant          @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([tenant_id, owner_type, owner_id], map: "idx_contact_point_owner")
  @@schema("core")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model document {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id  String    @db.Uuid
  code       String?
  title      String?
  tags       String[]
  metadata   Json?
  created_at DateTime  @default(now()) @db.Timestamptz(6)
  created_by String
  updated_at DateTime? @db.Timestamptz(6)
  updated_by String?
  tenant     Tenant    @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([tags], map: "idx_document_tags", type: Gin)
  @@index([tenant_id, code], map: "idx_document_tenant_code")
  @@schema("core")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model email_otp_instance {
  id            String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id     String     @db.Uuid
  mfa_config_id String     @db.Uuid
  email_address String
  verified_at   DateTime?  @db.Timestamptz(6)
  created_at    DateTime   @default(now()) @db.Timestamptz(6)
  created_by    String
  updated_at    DateTime?  @db.Timestamptz(6)
  updated_by    String?
  mfa_config    mfa_config @relation(fields: [mfa_config_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenant        Tenant     @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([tenant_id, email_address], map: "idx_email_otp_instance_email")
  @@index([mfa_config_id], map: "idx_email_otp_instance_mfa_config")
  @@schema("core")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model entitlement {
  id              String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id       String           @db.Uuid
  principal_id    String?          @db.Uuid
  role_id         String?          @db.Uuid
  group_id        String?          @db.Uuid
  capability      String
  resource_type   String?
  resource_id     String?
  effect          String           @default("allow")
  granted_at      DateTime         @default(now()) @db.Timestamptz(6)
  granted_by      String?
  expires_at      DateTime?        @db.Timestamptz(6)
  metadata        Json?
  principal_group principal_group? @relation(fields: [group_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  principal       Principal?       @relation(fields: [principal_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  role            Role?            @relation(fields: [role_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenant          Tenant           @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([tenant_id, capability], map: "idx_entitlement_capability")
  @@index([tenant_id, group_id], map: "idx_entitlement_group")
  @@index([tenant_id, principal_id], map: "idx_entitlement_principal")
  @@index([tenant_id, role_id], map: "idx_entitlement_role")
  @@schema("core")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model entity_tag {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id   String   @db.Uuid
  entity_type String
  entity_id   String   @db.Uuid
  tag_key     String
  tag_value   String?
  created_at  DateTime @default(now()) @db.Timestamptz(6)
  created_by  String
  tenant      Tenant   @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([entity_type, entity_id, tag_key], map: "entity_tag_entity_tag_uniq")
  @@index([tenant_id, entity_type, entity_id], map: "idx_entity_tag_entity")
  @@index([tenant_id, tag_key, tag_value], map: "idx_entity_tag_key_value")
  @@schema("core")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model feature_flag {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id   String    @db.Uuid
  flag_key    String
  flag_name   String?
  description String?
  is_enabled  Boolean   @default(false)
  enabled_at  DateTime? @db.Timestamptz(6)
  disabled_at DateTime? @db.Timestamptz(6)
  rollout_pct Int?      @default(100)
  config      Json?
  metadata    Json?
  created_at  DateTime  @default(now()) @db.Timestamptz(6)
  created_by  String
  updated_at  DateTime? @db.Timestamptz(6)
  updated_by  String?
  tenant      Tenant    @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([tenant_id, flag_key], map: "feature_flag_tenant_key_uniq")
  @@index([tenant_id, is_enabled], map: "idx_feature_flag_tenant_enabled")
  @@schema("core")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model field_access_log {
  id                    String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id             String                 @db.Uuid
  entity_key            String
  record_id             String?                @db.Uuid
  subject_id            String                 @db.Uuid
  subject_type          String
  action                String
  field_path            String
  was_allowed           Boolean
  mask_applied          String?
  policy_id             String?                @db.Uuid
  request_id            String?
  trace_id              String?
  correlation_id        String?
  created_at            DateTime               @default(now()) @db.Timestamptz(6)
  field_security_policy field_security_policy? @relation(fields: [policy_id], references: [id], onUpdate: NoAction, map: "field_access_log_policy_fk")
  tenant                Tenant                 @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([tenant_id, entity_key, created_at(sort: Desc)], map: "idx_field_access_log_entity")
  @@index([tenant_id, subject_id, created_at(sort: Desc)], map: "idx_field_access_log_subject")
  @@schema("core")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model job {
  id            String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id     String    @db.Uuid
  code          String
  name          String
  schedule_kind String
  schedule_expr String?
  is_active     Boolean   @default(true)
  config        Json?
  created_at    DateTime  @default(now()) @db.Timestamptz(6)
  created_by    String
  updated_at    DateTime? @db.Timestamptz(6)
  updated_by    String?
  tenant        Tenant    @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  job_run       job_run[]

  @@unique([tenant_id, code], map: "job_code_uniq")
  @@schema("core")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model job_run {
  id           String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id    String    @db.Uuid
  job_id       String    @db.Uuid
  status       String    @default("queued")
  started_at   DateTime? @db.Timestamptz(6)
  finished_at  DateTime? @db.Timestamptz(6)
  attempts     Int       @default(0)
  max_attempts Int       @default(3)
  log_ref      String?
  last_error   String?
  created_at   DateTime  @default(now()) @db.Timestamptz(6)
  job          job       @relation(fields: [job_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenant       Tenant    @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([tenant_id, job_id, created_at(sort: Desc)], map: "idx_job_run_tenant_job_time")
  @@schema("core")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model core_lifecycle {
  id                String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id         String              @db.Uuid
  code              String
  name              String
  description       String?
  entity_type       String
  definition        Json                @default("{\"states\": [], \"transitions\": []}")
  is_active         Boolean             @default(true)
  created_at        DateTime            @default(now()) @db.Timestamptz(6)
  created_by        String
  updated_at        DateTime?           @db.Timestamptz(6)
  updated_by        String?
  tenant            Tenant              @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  lifecycle_version lifecycle_version[]
  workflow_instance workflow_instance[]

  @@unique([tenant_id, code], map: "lifecycle_tenant_code_uniq")
  @@index([tenant_id, entity_type], map: "idx_lifecycle_entity_type")
  @@index([tenant_id], map: "idx_lifecycle_tenant")
  @@map("lifecycle")
  @@schema("core")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model lifecycle_version {
  id                String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id         String              @db.Uuid
  lifecycle_id      String              @db.Uuid
  version           Int
  definition        Json
  created_at        DateTime            @default(now()) @db.Timestamptz(6)
  created_by        String
  lifecycle         core_lifecycle      @relation(fields: [lifecycle_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenant            Tenant              @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  workflow_instance workflow_instance[]

  @@unique([lifecycle_id, version], map: "lifecycle_version_lc_ver_uniq")
  @@index([lifecycle_id, version(sort: Desc)], map: "idx_lifecycle_version_lifecycle")
  @@schema("core")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model mfa_challenge {
  id             String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id      String    @db.Uuid
  principal_id   String    @db.Uuid
  challenge_type String
  challenge_data Json
  secret         String
  attempts       Int       @default(0)
  max_attempts   Int       @default(3)
  status         String    @default("pending")
  verified_at    DateTime? @db.Timestamptz(6)
  expires_at     DateTime  @default(dbgenerated("(now() + '00:10:00'::interval)")) @db.Timestamptz(6)
  created_at     DateTime  @default(now()) @db.Timestamptz(6)
  created_by     String
  principal      Principal @relation(fields: [principal_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenant         Tenant    @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([tenant_id, principal_id, status], map: "idx_mfa_challenge_principal")
  @@schema("core")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model mfa_config {
  id                  String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id           String                @db.Uuid
  principal_id        String                @db.Uuid
  method_type         String
  is_enabled          Boolean               @default(false)
  is_verified         Boolean               @default(false)
  is_primary          Boolean               @default(false)
  secret              String?
  backup_codes        String[]
  device_name         String?
  device_id           String?
  device_info         Json?
  last_used_at        DateTime?             @db.Timestamptz(6)
  verified_at         DateTime?             @db.Timestamptz(6)
  metadata            Json?
  created_at          DateTime              @default(now()) @db.Timestamptz(6)
  created_by          String
  updated_at          DateTime?             @db.Timestamptz(6)
  updated_by          String?
  email_otp_instance  email_otp_instance[]
  principal           Principal             @relation(fields: [principal_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenant              Tenant                @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  sms_otp_instance    sms_otp_instance[]
  totp_instance       totp_instance[]
  webauthn_credential webauthn_credential[]

  @@unique([principal_id, method_type], map: "mfa_config_principal_method_uniq")
  @@index([tenant_id, principal_id], map: "idx_mfa_config_principal")
  @@schema("core")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model module {
  id                         String                       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code                       String                       @unique
  name                       String
  description                String?
  workspace_id               String?                      @db.Uuid
  config                     Json?
  created_at                 DateTime                     @default(now()) @db.Timestamptz(6)
  created_by                 String                       @default("system")
  updated_at                 DateTime?                    @db.Timestamptz(6)
  updated_by                 String?
  workspace                  workspace?                   @relation(fields: [workspace_id], references: [id], onUpdate: NoAction, map: "module_workspace_fk")
  tenant_module_subscription tenant_module_subscription[]

  @@index([code], map: "idx_module_code")
  @@schema("core")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model operation {
  id                 String                    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  category_id        String                    @db.Uuid
  code               String
  name               String
  description        String?
  requires_record    Boolean                   @default(false)
  requires_ownership Boolean                   @default(false)
  sort_order         Int                       @default(0)
  created_at         DateTime                  @default(now()) @db.Timestamptz(6)
  created_by         String                    @default("system")
  updated_at         DateTime?                 @db.Timestamptz(6)
  updated_by         String?
  operation_category operation_category        @relation(fields: [category_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  persona_capability persona_capability[]
  ruleOperations     PermissionRuleOperation[]

  @@unique([category_id, code], map: "operation_category_code_uniq")
  @@index([category_id], map: "idx_operation_category")
  @@index([code], map: "idx_operation_code")
  @@schema("core")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model operation_category {
  id          String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code        String      @unique
  name        String
  description String?
  sort_order  Int         @default(0)
  created_at  DateTime    @default(now()) @db.Timestamptz(6)
  created_by  String      @default("system")
  updated_at  DateTime?   @db.Timestamptz(6)
  updated_by  String?
  operation   operation[]

  @@index([sort_order], map: "idx_operation_category_sort")
  @@schema("core")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model organizational_unit {
  id                        String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id                 String                @db.Uuid
  code                      String
  name                      String
  description               String?
  parent_id                 String?               @db.Uuid
  metadata                  Json?
  created_at                DateTime              @default(now()) @db.Timestamptz(6)
  created_by                String
  updated_at                DateTime?             @db.Timestamptz(6)
  updated_by                String?
  organizational_unit       organizational_unit?  @relation("organizational_unitToorganizational_unit", fields: [parent_id], references: [id], onUpdate: NoAction)
  other_organizational_unit organizational_unit[] @relation("organizational_unitToorganizational_unit")
  tenant                    Tenant                @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  principal_ou              principal_ou[]

  @@unique([tenant_id, code], map: "organizational_unit_tenant_code_uniq")
  @@index([parent_id], map: "idx_ou_parent")
  @@index([tenant_id], map: "idx_ou_tenant")
  @@schema("core")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model outbox {
  id           String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id    String    @db.Uuid
  topic        String
  event_key    String?
  payload      Json
  status       String    @default("pending")
  attempts     Int       @default(0)
  available_at DateTime  @default(now()) @db.Timestamptz(6)
  locked_at    DateTime? @db.Timestamptz(6)
  locked_by    String?
  last_error   String?
  created_at   DateTime  @default(now()) @db.Timestamptz(6)
  created_by   String
  tenant       Tenant    @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([tenant_id, status, available_at], map: "idx_outbox_pick")
  @@schema("core")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model password_history {
  id            String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id     String    @db.Uuid
  principal_id  String    @db.Uuid
  password_hash String
  changed_at    DateTime  @default(now()) @db.Timestamptz(6)
  changed_by    String
  principal     Principal @relation(fields: [principal_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenant        Tenant    @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([tenant_id, principal_id, changed_at(sort: Desc)], map: "idx_password_history_principal")
  @@schema("core")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model persona {
  id                         String                       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code                       String                       @unique
  name                       String
  description                String?
  scope_mode                 String                       @default("tenant")
  priority                   Int                          @default(0)
  is_system                  Boolean                      @default(false)
  created_at                 DateTime                     @default(now()) @db.Timestamptz(6)
  created_by                 String                       @default("system")
  updated_at                 DateTime?                    @db.Timestamptz(6)
  updated_by                 String?
  persona_capability         persona_capability[]
  principal_workspace_access principal_workspace_access[]

  @@index([scope_mode], map: "idx_persona_scope_mode")
  @@schema("core")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model persona_capability {
  id              String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  persona_id      String    @db.Uuid
  operation_id    String    @db.Uuid
  is_granted      Boolean   @default(true)
  constraint_type String    @default("none")
  created_at      DateTime  @default(now()) @db.Timestamptz(6)
  updated_at      DateTime? @db.Timestamptz(6)
  operation       operation @relation(fields: [operation_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  persona         persona   @relation(fields: [persona_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([persona_id, operation_id], map: "persona_capability_persona_op_uniq")
  @@index([operation_id], map: "idx_persona_capability_operation")
  @@index([persona_id], map: "idx_persona_capability_persona")
  @@schema("core")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model principal_group {
  id          String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id   String        @db.Uuid
  code        String
  name        String
  description String?
  metadata    Json?
  created_at  DateTime      @default(now()) @db.Timestamptz(6)
  created_by  String
  updated_at  DateTime?     @db.Timestamptz(6)
  updated_by  String?
  entitlement entitlement[]
  members     GroupMember[]
  tenant      Tenant        @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([tenant_id, code], map: "principal_group_tenant_code_uniq")
  @@index([tenant_id], map: "idx_principal_group_tenant")
  @@schema("core")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model principal_locale_override {
  id                    String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id             String    @db.Uuid
  principal_id          String    @unique(map: "principal_locale_override_principal_uniq") @db.Uuid
  preferred_locale      String
  preferred_timezone    String
  preferred_currency    String?
  preferred_date_format String?
  preferred_time_format String?
  created_at            DateTime  @default(now()) @db.Timestamptz(6)
  created_by            String
  updated_at            DateTime? @db.Timestamptz(6)
  updated_by            String?
  principal             Principal @relation(fields: [principal_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenant                Tenant    @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([principal_id], map: "idx_principal_locale_override_principal")
  @@schema("core")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model principal_ou {
  id                  String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id           String              @db.Uuid
  principal_id        String              @db.Uuid
  ou_id               String              @db.Uuid
  assigned_at         DateTime            @default(now()) @db.Timestamptz(6)
  assigned_by         String?
  organizational_unit organizational_unit @relation(fields: [ou_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  principal           Principal           @relation(fields: [principal_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenant              Tenant              @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([principal_id, ou_id], map: "principal_ou_principal_ou_uniq")
  @@index([tenant_id, ou_id], map: "idx_principal_ou_ou")
  @@index([tenant_id, principal_id], map: "idx_principal_ou_principal")
  @@schema("core")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model principal_role {
  id           String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id    String    @db.Uuid
  principal_id String    @db.Uuid
  role_id      String    @db.Uuid
  assigned_at  DateTime  @default(now()) @db.Timestamptz(6)
  assigned_by  String?
  expires_at   DateTime? @db.Timestamptz(6)
  principal    Principal @relation(fields: [principal_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  role         Role      @relation(fields: [role_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenant       Tenant    @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([principal_id, role_id], map: "principal_role_principal_role_uniq")
  @@index([tenant_id, principal_id], map: "idx_principal_role_principal")
  @@index([tenant_id, role_id], map: "idx_principal_role_role")
  @@schema("core")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model principal_workspace_access {
  id           String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id    String    @db.Uuid
  principal_id String    @db.Uuid
  workspace_id String    @db.Uuid
  role_id      String?   @db.Uuid
  persona_id   String?   @db.Uuid
  access_level String    @default("member")
  granted_at   DateTime  @default(now()) @db.Timestamptz(6)
  granted_by   String?
  expires_at   DateTime? @db.Timestamptz(6)
  metadata     Json?
  created_at   DateTime  @default(now()) @db.Timestamptz(6)
  created_by   String
  updated_at   DateTime? @db.Timestamptz(6)
  updated_by   String?
  persona      persona?  @relation(fields: [persona_id], references: [id], onUpdate: NoAction)
  principal    Principal @relation(fields: [principal_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  role         Role?     @relation(fields: [role_id], references: [id], onUpdate: NoAction)
  tenant       Tenant    @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  workspace    workspace @relation(fields: [workspace_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([principal_id, workspace_id], map: "principal_workspace_access_uniq")
  @@index([access_level], map: "idx_principal_workspace_access_access_level")
  @@index([principal_id], map: "idx_principal_workspace_access_principal")
  @@index([role_id], map: "idx_principal_workspace_access_role")
  @@index([workspace_id], map: "idx_principal_workspace_access_workspace")
  @@schema("core")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model security_event {
  id             String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id      String     @db.Uuid
  principal_id   String?    @db.Uuid
  event_type     String
  severity       String     @default("info")
  occurred_at    DateTime   @default(now()) @db.Timestamptz(6)
  ip_address     String?
  user_agent     String?
  correlation_id String?
  details        Json?
  created_at     DateTime   @default(now()) @db.Timestamptz(6)
  principal      Principal? @relation(fields: [principal_id], references: [id], onUpdate: NoAction)
  tenant         Tenant     @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([tenant_id, principal_id], map: "idx_security_event_principal")
  @@index([tenant_id, occurred_at(sort: Desc)], map: "idx_security_event_tenant_time")
  @@index([tenant_id, event_type], map: "idx_security_event_type")
  @@schema("core")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model sms_otp_instance {
  id            String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id     String     @db.Uuid
  mfa_config_id String     @db.Uuid
  phone_number  String
  verified_at   DateTime?  @db.Timestamptz(6)
  created_at    DateTime   @default(now()) @db.Timestamptz(6)
  created_by    String
  updated_at    DateTime?  @db.Timestamptz(6)
  updated_by    String?
  mfa_config    mfa_config @relation(fields: [mfa_config_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenant        Tenant     @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([mfa_config_id], map: "idx_sms_otp_instance_mfa_config")
  @@index([tenant_id, phone_number], map: "idx_sms_otp_instance_phone")
  @@schema("core")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model system_config {
  id           String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id    String?   @db.Uuid
  config_key   String
  config_value String
  config_type  String    @default("string")
  description  String?
  is_encrypted Boolean   @default(false)
  is_global    Boolean   @default(false)
  created_at   DateTime  @default(now()) @db.Timestamptz(6)
  created_by   String
  updated_at   DateTime? @db.Timestamptz(6)
  updated_by   String?
  tenant       Tenant?   @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([tenant_id, config_key], map: "idx_system_config_tenant_key")
  @@schema("core")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model tenant_locale_policy {
  id                    String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id             String    @db.Uuid
  code                  String
  name                  String?
  default_locale        String    @default("en-US")
  default_timezone      String    @default("UTC")
  default_currency      String    @default("USD")
  default_date_format   String    @default("MM/dd/yyyy")
  default_time_format   String    @default("hh:mm:ss a")
  default_decimal_sep   String    @default(".")
  default_thousands_sep String    @default(",")
  data_residency        String?
  language_requirements String[]
  phone_format_hint     String?
  postal_code_pattern   String?
  metadata              Json?
  created_at            DateTime  @default(now()) @db.Timestamptz(6)
  created_by            String
  updated_at            DateTime? @db.Timestamptz(6)
  updated_by            String?
  tenant                Tenant    @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([tenant_id, code], map: "tenant_locale_policy_tenant_code_uniq")
  @@index([tenant_id, code], map: "idx_tenant_locale_policy_code")
  @@index([tenant_id], map: "idx_tenant_locale_policy_tenant")
  @@schema("core")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model tenant_module_subscription {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id  String    @db.Uuid
  module_id  String    @db.Uuid
  is_active  Boolean   @default(true)
  created_at DateTime  @default(now()) @db.Timestamptz(6)
  created_by String    @default("system")
  updated_at DateTime? @db.Timestamptz(6)
  updated_by String?
  module     module    @relation(fields: [module_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenant     Tenant    @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([tenant_id, module_id], map: "tenant_module_subscription_uniq")
  @@index([module_id], map: "idx_tenant_module_sub_module")
  @@index([tenant_id], map: "idx_tenant_module_sub_tenant")
  @@schema("core")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model totp_instance {
  id               String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id        String     @db.Uuid
  mfa_config_id    String     @db.Uuid
  secret           String
  algorithm        String     @default("SHA1")
  digits           Int        @default(6)
  period           Int        @default(30)
  qr_code_url      String?
  manual_entry_key String?
  last_counter     Int?
  last_verified_at DateTime?  @db.Timestamptz(6)
  created_at       DateTime   @default(now()) @db.Timestamptz(6)
  created_by       String
  mfa_config       mfa_config @relation(fields: [mfa_config_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenant           Tenant     @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([mfa_config_id], map: "idx_totp_instance_mfa_config")
  @@schema("core")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model has constraints using non-default deferring rules and requires additional setup for migrations. Visit https://pris.ly/d/constraint-deferring for more info.
model trusted_device {
  id                 String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id          String    @db.Uuid
  principal_id       String    @db.Uuid
  device_id          String
  device_fingerprint String?
  device_name        String?
  device_type        String?
  user_agent         String?
  ip_address         String?
  is_trusted         Boolean   @default(false)
  last_seen_at       DateTime? @db.Timestamptz(6)
  verified_at        DateTime? @db.Timestamptz(6)
  expires_at         DateTime? @db.Timestamptz(6)
  metadata           Json?
  created_at         DateTime  @default(now()) @db.Timestamptz(6)
  created_by         String
  principal          Principal @relation(fields: [principal_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenant             Tenant    @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([principal_id, device_id], map: "trusted_device_principal_id_uniq")
  @@index([tenant_id, device_fingerprint], map: "idx_trusted_device_fingerprint")
  @@index([tenant_id, principal_id], map: "idx_trusted_device_principal")
  @@schema("core")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model webauthn_credential {
  id                         String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id                  String     @db.Uuid
  mfa_config_id              String     @db.Uuid
  credential_id              Bytes
  public_key                 String
  counter                    BigInt?
  aaguid                     String?    @db.Uuid
  attestation                String?
  transports                 String[]
  is_backup_eligible         Boolean?
  is_backup_state            Boolean?
  is_discoverable_credential Boolean?
  last_used_at               DateTime?  @db.Timestamptz(6)
  verified_at                DateTime?  @db.Timestamptz(6)
  created_at                 DateTime   @default(now()) @db.Timestamptz(6)
  created_by                 String
  mfa_config                 mfa_config @relation(fields: [mfa_config_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenant                     Tenant     @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([tenant_id, credential_id], map: "webauthn_credential_id_uniq")
  @@index([mfa_config_id], map: "idx_webauthn_credential_mfa_config")
  @@schema("core")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model workflow_instance {
  id                                                  String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id                                           String                @db.Uuid
  entity_type                                         String
  entity_id                                           String                @db.Uuid
  entity_version_id                                   String?               @db.Uuid
  lifecycle_id                                        String                @db.Uuid
  lifecycle_version_id                                String                @db.Uuid
  current_state                                       String
  previous_state                                      String?
  status                                              String                @default("active")
  data                                                Json?
  context                                             Json?
  initiated_by                                        String?               @db.Uuid
  initiated_at                                        DateTime              @default(now()) @db.Timestamptz(6)
  completed_by                                        String?               @db.Uuid
  completed_at                                        DateTime?             @db.Timestamptz(6)
  created_at                                          DateTime              @default(now()) @db.Timestamptz(6)
  created_by                                          String
  updated_at                                          DateTime?             @db.Timestamptz(6)
  updated_by                                          String?
  principal_workflow_instance_completed_byToprincipal Principal?            @relation("workflow_instance_completed_byToprincipal", fields: [completed_by], references: [id], onUpdate: NoAction)
  principal_workflow_instance_initiated_byToprincipal Principal?            @relation("workflow_instance_initiated_byToprincipal", fields: [initiated_by], references: [id], onUpdate: NoAction)
  lifecycle                                           core_lifecycle        @relation(fields: [lifecycle_id], references: [id], onUpdate: NoAction)
  lifecycle_version                                   lifecycle_version     @relation(fields: [lifecycle_version_id], references: [id], onUpdate: NoAction)
  tenant                                              Tenant                @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  workflow_transition                                 workflow_transition[]

  @@unique([entity_type, entity_id], map: "workflow_instance_entity_uniq")
  @@index([tenant_id, current_state], map: "idx_workflow_instance_current_state")
  @@index([tenant_id, entity_type, entity_id], map: "idx_workflow_instance_entity")
  @@index([tenant_id, status], map: "idx_workflow_instance_tenant_status")
  @@schema("core")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model workflow_transition {
  id                   String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id            String            @db.Uuid
  workflow_instance_id String            @db.Uuid
  from_state           String
  to_state             String
  transition_name      String?
  transition_data      Json?
  triggered_by         String            @db.Uuid
  triggered_at         DateTime          @default(now()) @db.Timestamptz(6)
  created_at           DateTime          @default(now()) @db.Timestamptz(6)
  tenant               Tenant            @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  principal            Principal         @relation(fields: [triggered_by], references: [id], onDelete: SetNull, onUpdate: NoAction)
  workflow_instance    workflow_instance @relation(fields: [workflow_instance_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([workflow_instance_id, triggered_at(sort: Desc)], map: "idx_workflow_transition_instance")
  @@index([tenant_id, triggered_at(sort: Desc)], map: "idx_workflow_transition_tenant_time")
  @@schema("core")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model workspace {
  id                         String                       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code                       String                       @unique
  name                       String
  description                String?
  sort_order                 Int                          @default(0)
  metadata                   Json?
  created_at                 DateTime                     @default(now()) @db.Timestamptz(6)
  created_by                 String                       @default("system")
  updated_at                 DateTime?                    @db.Timestamptz(6)
  updated_by                 String?
  module                     module[]
  principal_workspace_access principal_workspace_access[]
  workspace_feature          workspace_feature[]
  workspace_usage_metric     workspace_usage_metric[]

  @@index([sort_order], map: "idx_workspace_sort")
  @@schema("core")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model workspace_feature {
  id           String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id    String    @db.Uuid
  workspace_id String    @db.Uuid
  feature_code String
  feature_name String?
  is_enabled   Boolean   @default(true)
  enabled_at   DateTime? @db.Timestamptz(6)
  config       Json?
  metadata     Json?
  created_at   DateTime  @default(now()) @db.Timestamptz(6)
  created_by   String
  updated_at   DateTime? @db.Timestamptz(6)
  updated_by   String?
  tenant       Tenant    @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  workspace    workspace @relation(fields: [workspace_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([workspace_id, feature_code], map: "workspace_feature_ws_feat_uniq")
  @@index([feature_code], map: "idx_workspace_feature_code")
  @@index([workspace_id, is_enabled], map: "idx_workspace_feature_workspace")
  @@schema("core")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model workspace_usage_metric {
  id           String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id    String    @db.Uuid
  workspace_id String    @db.Uuid
  metric_key   String
  metric_name  String?
  metric_value Decimal?  @db.Decimal
  metric_unit  String?
  period_start DateTime  @db.Timestamptz(6)
  period_end   DateTime? @db.Timestamptz(6)
  recorded_at  DateTime  @default(now()) @db.Timestamptz(6)
  created_at   DateTime  @default(now()) @db.Timestamptz(6)
  tenant       Tenant    @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  workspace    workspace @relation(fields: [workspace_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([workspace_id, metric_key, period_end(sort: Desc)], map: "idx_workspace_usage_metric_metric_key")
  @@index([workspace_id, period_end(sort: Desc)], map: "idx_workspace_usage_metric_workspace")
  @@schema("core")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model approval_sla_policy {
  id               String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id        String   @db.Uuid
  code             String
  name             String
  timers           Json
  escalation_chain Json?
  created_at       DateTime @default(now()) @db.Timestamptz(6)
  created_by       String
  tenant           Tenant   @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([tenant_id, code], map: "approval_sla_code_uniq")
  @@schema("meta")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model approval_template {
  id                      String                    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id               String                    @db.Uuid
  code                    String
  name                    String
  behaviors               Json?
  escalation_style        String?
  created_at              DateTime                  @default(now()) @db.Timestamptz(6)
  created_by              String
  tenant                  Tenant                    @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  approval_template_rule  approval_template_rule[]
  approval_template_stage approval_template_stage[]

  @@unique([tenant_id, code], map: "approval_template_code_uniq")
  @@schema("meta")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model approval_template_rule {
  id                   String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id            String            @db.Uuid
  approval_template_id String            @db.Uuid
  priority             Int               @default(100)
  conditions           Json
  assign_to            Json
  created_at           DateTime          @default(now()) @db.Timestamptz(6)
  created_by           String
  approval_template    approval_template @relation(fields: [approval_template_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenant               Tenant            @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([tenant_id, approval_template_id, priority], map: "idx_approval_template_rule")
  @@schema("meta")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model approval_template_stage {
  id                   String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id            String            @db.Uuid
  approval_template_id String            @db.Uuid
  stage_no             Int
  name                 String?
  mode                 String            @default("serial")
  quorum               Json?
  created_at           DateTime          @default(now()) @db.Timestamptz(6)
  created_by           String
  approval_template    approval_template @relation(fields: [approval_template_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenant               Tenant            @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([tenant_id, approval_template_id, stage_no], map: "template_stage_uniq")
  @@schema("meta")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model entity {
  id                    String                  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id             String                  @db.Uuid
  module_id             String
  name                  String
  kind                  String                  @default("ent")
  table_schema          String                  @default("ent")
  table_name            String
  naming_policy         Json?
  feature_flags         Json?
  is_active             Boolean                 @default(true)
  created_at            DateTime                @default(now()) @db.Timestamptz(6)
  created_by            String
  updated_at            DateTime?               @db.Timestamptz(6)
  updated_by            String?
  tenant                Tenant                  @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  entity_policy         entity_policy[]
  entity_version        entity_version[]
  field_security_policy field_security_policy[]
  overlay               overlay[]

  @@unique([tenant_id, name], map: "entity_name_uniq")
  @@index([tenant_id, module_id], map: "idx_entity_module")
  @@schema("meta")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model entity_compiled {
  id                String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id         String         @db.Uuid
  entity_version_id String         @db.Uuid
  compiled_json     Json
  compiled_hash     String
  generated_at      DateTime       @default(now()) @db.Timestamptz(6)
  created_at        DateTime       @default(now()) @db.Timestamptz(6)
  created_by        String
  entity_version    entity_version @relation(fields: [entity_version_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenant            Tenant         @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([tenant_id, entity_version_id, compiled_hash], map: "entity_compiled_hash_uniq")
  @@schema("meta")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model entity_compiled_overlay {
  id                String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id         String         @db.Uuid
  entity_version_id String         @db.Uuid
  overlay_set       Json
  compiled_json     Json
  compiled_hash     String
  generated_at      DateTime       @default(now()) @db.Timestamptz(6)
  created_at        DateTime       @default(now()) @db.Timestamptz(6)
  created_by        String
  entity_version    entity_version @relation(fields: [entity_version_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenant            Tenant         @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([tenant_id, entity_version_id, compiled_hash], map: "idx_entity_compiled_overlay_lookup")
  @@schema("meta")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model entity_lifecycle {
  id           String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id    String         @db.Uuid
  entity_name  String
  lifecycle_id String         @db.Uuid
  conditions   Json?
  priority     Int            @default(100)
  created_at   DateTime       @default(now()) @db.Timestamptz(6)
  created_by   String
  lifecycle    meta_lifecycle @relation(fields: [lifecycle_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenant       Tenant         @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([tenant_id, entity_name, priority], map: "idx_entity_lifecycle_resolution")
  @@schema("meta")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model entity_lifecycle_route_compiled {
  id            String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id     String   @db.Uuid
  entity_name   String
  compiled_json Json
  compiled_hash String
  generated_at  DateTime @default(now()) @db.Timestamptz(6)
  created_at    DateTime @default(now()) @db.Timestamptz(6)
  created_by    String
  tenant        Tenant   @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([tenant_id, entity_name, compiled_hash], map: "route_compiled_hash_uniq")
  @@schema("meta")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model entity_policy {
  id                String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id         String          @db.Uuid
  entity_id         String?         @db.Uuid
  entity_version_id String?         @db.Uuid
  access_mode       String          @default("default_deny")
  ou_scope_mode     String          @default("none")
  audit_mode        String          @default("enabled")
  retention_policy  Json?
  default_filters   Json?
  cache_flags       Json?
  created_at        DateTime        @default(now()) @db.Timestamptz(6)
  created_by        String
  updated_at        DateTime?       @db.Timestamptz(6)
  updated_by        String?
  entity            entity?         @relation(fields: [entity_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  entity_version    entity_version? @relation(fields: [entity_version_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenant            Tenant          @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@schema("meta")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model entity_version {
  id                      String                    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id               String                    @db.Uuid
  entity_id               String                    @db.Uuid
  version_no              Int                       @default(1)
  status                  String                    @default("draft")
  label                   String?
  behaviors               Json?
  published_at            DateTime?                 @db.Timestamptz(6)
  published_by            String?
  created_at              DateTime                  @default(now()) @db.Timestamptz(6)
  created_by              String
  updated_at              DateTime?                 @db.Timestamptz(6)
  updated_by              String?
  entity_compiled         entity_compiled[]
  entity_compiled_overlay entity_compiled_overlay[]
  entity_policy           entity_policy[]
  entity                  entity                    @relation(fields: [entity_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenant                  Tenant                    @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  field                   field[]
  index_def               index_def[]
  overlay                 overlay[]
  relation                relation[]

  @@unique([tenant_id, entity_id, version_no], map: "entity_version_uniq")
  @@index([tenant_id, entity_id, status], map: "idx_entity_version_entity_status")
  @@schema("meta")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model field {
  id                String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id         String         @db.Uuid
  entity_version_id String         @db.Uuid
  name              String
  column_name       String?
  data_type         String
  ui_type           String?
  is_required       Boolean        @default(false)
  is_unique         Boolean        @default(false)
  is_searchable     Boolean        @default(false)
  is_filterable     Boolean        @default(false)
  default_value     Json?
  validation        Json?
  lookup_config     Json?
  sort_order        Int            @default(0)
  is_active         Boolean        @default(true)
  created_at        DateTime       @default(now()) @db.Timestamptz(6)
  created_by        String
  updated_at        DateTime?      @db.Timestamptz(6)
  updated_by        String?
  entity_version    entity_version @relation(fields: [entity_version_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenant            Tenant         @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([tenant_id, entity_version_id, name], map: "field_name_uniq")
  @@index([tenant_id, entity_version_id], map: "idx_field_entity_version")
  @@schema("meta")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model field_security_policy {
  id               String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id        String             @db.Uuid
  entity_id        String             @db.Uuid
  field_path       String
  policy_type      String
  role_list        String[]
  abac_condition   Json?
  mask_strategy    String?
  mask_config      Json?
  scope            String             @default("entity")
  scope_ref        String?            @db.Uuid
  priority         Int                @default(100)
  is_active        Boolean            @default(true)
  metadata         Json?
  created_at       DateTime           @default(now()) @db.Timestamptz(6)
  created_by       String
  updated_at       DateTime?          @db.Timestamptz(6)
  updated_by       String?
  version          Int                @default(1)
  field_access_log field_access_log[]
  entity           entity             @relation(fields: [entity_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenant           Tenant             @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([tenant_id, entity_id, field_path, policy_type, scope, scope_ref], map: "field_security_policy_uniq")
  @@index([tenant_id, entity_id], map: "idx_field_security_entity")
  @@index([field_path], map: "idx_field_security_field")
  @@index([tenant_id, entity_id, field_path, policy_type, is_active], map: "idx_field_security_lookup")
  @@index([entity_id, priority], map: "idx_field_security_priority")
  @@index([scope, scope_ref], map: "idx_field_security_scope")
  @@index([policy_type], map: "idx_field_security_type")
  @@schema("meta")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model index_def {
  id                String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id         String         @db.Uuid
  entity_version_id String         @db.Uuid
  name              String
  is_unique         Boolean        @default(false)
  method            String         @default("btree")
  columns           Json
  where_clause      String?
  created_at        DateTime       @default(now()) @db.Timestamptz(6)
  created_by        String
  entity_version    entity_version @relation(fields: [entity_version_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenant            Tenant         @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([tenant_id, entity_version_id, name], map: "index_def_name_uniq")
  @@schema("meta")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model meta_lifecycle {
  id                   String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id            String                 @db.Uuid
  code                 String
  name                 String
  description          String?
  version_no           Int                    @default(1)
  is_active            Boolean                @default(true)
  config               Json?
  created_at           DateTime               @default(now()) @db.Timestamptz(6)
  created_by           String
  entity_lifecycle     entity_lifecycle[]
  tenant               Tenant                 @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  lifecycle_state      lifecycle_state[]
  lifecycle_transition lifecycle_transition[]

  @@unique([tenant_id, code, version_no], map: "lifecycle_code_uniq")
  @@map("lifecycle")
  @@schema("meta")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model lifecycle_state {
  id                                                                       String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id                                                                String                 @db.Uuid
  lifecycle_id                                                             String                 @db.Uuid
  code                                                                     String
  name                                                                     String
  is_terminal                                                              Boolean                @default(false)
  sort_order                                                               Int                    @default(0)
  config                                                                   Json?
  created_at                                                               DateTime               @default(now()) @db.Timestamptz(6)
  created_by                                                               String
  lifecycle                                                                meta_lifecycle         @relation(fields: [lifecycle_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenant                                                                   Tenant                 @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  lifecycle_transition_lifecycle_transition_from_state_idTolifecycle_state lifecycle_transition[] @relation("lifecycle_transition_from_state_idTolifecycle_state")
  lifecycle_transition_lifecycle_transition_to_state_idTolifecycle_state   lifecycle_transition[] @relation("lifecycle_transition_to_state_idTolifecycle_state")

  @@unique([tenant_id, lifecycle_id, code], map: "lifecycle_state_code_uniq")
  @@schema("meta")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model lifecycle_timer_policy {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id  String   @db.Uuid
  code       String
  name       String
  rules      Json
  created_at DateTime @default(now()) @db.Timestamptz(6)
  created_by String
  tenant     Tenant   @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([tenant_id, code], map: "lifecycle_timer_policy_code_uniq")
  @@schema("meta")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model lifecycle_transition {
  id                                                                  String                      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id                                                           String                      @db.Uuid
  lifecycle_id                                                        String                      @db.Uuid
  from_state_id                                                       String                      @db.Uuid
  to_state_id                                                         String                      @db.Uuid
  operation_code                                                      String
  is_active                                                           Boolean                     @default(true)
  config                                                              Json?
  created_at                                                          DateTime                    @default(now()) @db.Timestamptz(6)
  created_by                                                          String
  lifecycle_state_lifecycle_transition_from_state_idTolifecycle_state lifecycle_state             @relation("lifecycle_transition_from_state_idTolifecycle_state", fields: [from_state_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  lifecycle                                                           meta_lifecycle              @relation(fields: [lifecycle_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenant                                                              Tenant                      @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  lifecycle_state_lifecycle_transition_to_state_idTolifecycle_state   lifecycle_state             @relation("lifecycle_transition_to_state_idTolifecycle_state", fields: [to_state_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  lifecycle_transition_gate                                           lifecycle_transition_gate[]

  @@index([tenant_id, lifecycle_id, from_state_id, operation_code], map: "idx_transition_lookup")
  @@schema("meta")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model lifecycle_transition_gate {
  id                   String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id            String               @db.Uuid
  transition_id        String               @db.Uuid
  required_operations  Json?
  approval_template_id String?              @db.Uuid
  conditions           Json?
  threshold_rules      Json?
  created_at           DateTime             @default(now()) @db.Timestamptz(6)
  created_by           String
  tenant               Tenant               @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  lifecycle_transition lifecycle_transition @relation(fields: [transition_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@schema("meta")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model overlay {
  id              String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id       String           @db.Uuid
  overlay_key     String
  description     String?
  base_entity_id  String           @db.Uuid
  base_version_id String?          @db.Uuid
  priority        Int              @default(100)
  conflict_mode   String           @default("fail")
  is_active       Boolean          @default(true)
  created_at      DateTime         @default(now()) @db.Timestamptz(6)
  created_by      String
  updated_at      DateTime?        @db.Timestamptz(6)
  updated_by      String?
  entity          entity           @relation(fields: [base_entity_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  entity_version  entity_version?  @relation(fields: [base_version_id], references: [id], onUpdate: NoAction)
  tenant          Tenant           @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  overlay_change  overlay_change[]

  @@unique([tenant_id, overlay_key], map: "overlay_key_uniq")
  @@index([tenant_id, base_entity_id], map: "idx_overlay_base_entity")
  @@index([base_entity_id, priority], map: "idx_overlay_priority")
  @@schema("meta")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model overlay_change {
  id           String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id    String   @db.Uuid
  overlay_id   String   @db.Uuid
  change_order Int
  kind         String
  path         String
  value        Json?
  created_at   DateTime @default(now()) @db.Timestamptz(6)
  created_by   String
  overlay      overlay  @relation(fields: [overlay_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenant       Tenant   @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([overlay_id, change_order], map: "overlay_change_order_uniq")
  @@index([overlay_id], map: "idx_overlay_change_overlay")
  @@schema("meta")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model relation {
  id                String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id         String         @db.Uuid
  entity_version_id String         @db.Uuid
  name              String
  relation_kind     String
  target_entity     String
  fk_field          String?
  target_key        String?
  on_delete         String         @default("restrict")
  ui_behavior       Json?
  created_at        DateTime       @default(now()) @db.Timestamptz(6)
  created_by        String
  entity_version    entity_version @relation(fields: [entity_version_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenant            Tenant         @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([tenant_id, entity_version_id, name], map: "relation_name_uniq")
  @@schema("meta")
}

model schema_provisions {
  id          Int      @id @default(autoincrement())
  file_name   String   @unique
  checksum    String
  executed_at DateTime @default(now()) @db.Timestamptz(6)

  @@schema("public")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model commodity_code {
  domain_code          String
  code                 String
  name                 String
  description          String?
  parent_code          String?
  level_no             Int?
  status               String           @default("active")
  metadata             Json             @default("{}")
  created_at           DateTime         @default(now()) @db.Timestamptz(6)
  created_by           String           @default("seed")
  updated_at           DateTime?        @db.Timestamptz(6)
  updated_by           String?
  commodity_domain     commodity_domain @relation(fields: [domain_code], references: [code], onDelete: Cascade, onUpdate: NoAction)
  commodity_code       commodity_code?  @relation("commodity_codeTocommodity_code", fields: [domain_code, parent_code], references: [domain_code, code], onDelete: NoAction, onUpdate: NoAction, map: "commodity_code_parent_fk")
  other_commodity_code commodity_code[] @relation("commodity_codeTocommodity_code")

  @@id([domain_code, code])
  @@index([domain_code, level_no], map: "idx_commodity_code_level")
  @@index([domain_code, parent_code], map: "idx_commodity_code_parent")
  @@schema("ref")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model commodity_domain {
  code           String           @id
  name           String
  standard       String?
  version        String?
  status         String           @default("active")
  metadata       Json             @default("{}")
  created_at     DateTime         @default(now()) @db.Timestamptz(6)
  created_by     String           @default("seed")
  updated_at     DateTime?        @db.Timestamptz(6)
  updated_by     String?
  commodity_code commodity_code[]

  @@schema("ref")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model country {
  code2         String         @id @db.Char(2)
  code3         String?        @unique @db.Char(3)
  numeric3      String?        @unique @db.Char(3)
  name          String
  official_name String?
  region        String?
  subregion     String?
  status        String         @default("active")
  metadata      Json           @default("{}")
  created_at    DateTime       @default(now()) @db.Timestamptz(6)
  created_by    String         @default("seed")
  updated_at    DateTime?      @db.Timestamptz(6)
  updated_by    String?
  locale        locale[]
  state_region  state_region[]

  @@schema("ref")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model currency {
  code        String    @id @db.Char(3)
  name        String
  symbol      String?
  minor_units Int?
  numeric3    String?   @unique @db.Char(3)
  status      String    @default("active")
  metadata    Json      @default("{}")
  created_at  DateTime  @default(now()) @db.Timestamptz(6)
  created_by  String    @default("seed")
  updated_at  DateTime? @db.Timestamptz(6)
  updated_by  String?

  @@schema("ref")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model industry_code {
  domain_code         String
  code                String
  name                String
  description         String?
  parent_code         String?
  level_no            Int?
  status              String          @default("active")
  metadata            Json            @default("{}")
  created_at          DateTime        @default(now()) @db.Timestamptz(6)
  created_by          String          @default("seed")
  updated_at          DateTime?       @db.Timestamptz(6)
  updated_by          String?
  industry_domain     industry_domain @relation(fields: [domain_code], references: [code], onDelete: Cascade, onUpdate: NoAction)
  industry_code       industry_code?  @relation("industry_codeToindustry_code", fields: [domain_code, parent_code], references: [domain_code, code], onDelete: NoAction, onUpdate: NoAction, map: "industry_code_parent_fk")
  other_industry_code industry_code[] @relation("industry_codeToindustry_code")

  @@id([domain_code, code])
  @@index([domain_code, level_no], map: "idx_industry_code_level")
  @@index([domain_code, parent_code], map: "idx_industry_code_parent")
  @@schema("ref")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model industry_domain {
  code          String          @id
  name          String
  standard      String?
  version       String?
  status        String          @default("active")
  metadata      Json            @default("{}")
  created_at    DateTime        @default(now()) @db.Timestamptz(6)
  created_by    String          @default("seed")
  updated_at    DateTime?       @db.Timestamptz(6)
  updated_by    String?
  industry_code industry_code[]

  @@schema("ref")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model label {
  entity      String
  code        String
  locale_code String
  name        String
  description String?
  created_at  DateTime  @default(now()) @db.Timestamptz(6)
  created_by  String    @default("seed")
  updated_at  DateTime? @db.Timestamptz(6)
  updated_by  String?
  locale      locale    @relation(fields: [locale_code], references: [code], onDelete: NoAction, onUpdate: NoAction)

  @@id([entity, code, locale_code])
  @@index([entity, locale_code], map: "idx_label_entity_locale")
  @@index([locale_code], map: "idx_label_locale")
  @@schema("ref")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model language {
  code        String    @id
  name        String
  native_name String?
  iso639_2    String?
  direction   String    @default("ltr")
  status      String    @default("active")
  metadata    Json      @default("{}")
  created_at  DateTime  @default(now()) @db.Timestamptz(6)
  created_by  String    @default("seed")
  updated_at  DateTime? @db.Timestamptz(6)
  updated_by  String?
  locale      locale[]

  @@schema("ref")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model locale {
  code          String    @id
  language_code String
  country_code2 String?   @db.Char(2)
  script        String?
  name          String
  direction     String?
  status        String    @default("active")
  metadata      Json      @default("{}")
  created_at    DateTime  @default(now()) @db.Timestamptz(6)
  created_by    String    @default("seed")
  updated_at    DateTime? @db.Timestamptz(6)
  updated_by    String?
  label         label[]
  country       country?  @relation(fields: [country_code2], references: [code2], onDelete: NoAction, onUpdate: NoAction)
  language      language  @relation(fields: [language_code], references: [code], onDelete: NoAction, onUpdate: NoAction)

  @@index([country_code2], map: "idx_locale_country")
  @@index([language_code], map: "idx_locale_language")
  @@schema("ref")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model state_region {
  code               String         @id
  country_code2      String         @db.Char(2)
  name               String
  category           String?
  parent_code        String?
  status             String         @default("active")
  metadata           Json           @default("{}")
  created_at         DateTime       @default(now()) @db.Timestamptz(6)
  created_by         String         @default("seed")
  updated_at         DateTime?      @db.Timestamptz(6)
  updated_by         String?
  country            country        @relation(fields: [country_code2], references: [code2], onDelete: Cascade, onUpdate: NoAction)
  state_region       state_region?  @relation("state_regionTostate_region", fields: [parent_code], references: [code], onDelete: NoAction, onUpdate: NoAction)
  other_state_region state_region[] @relation("state_regionTostate_region")

  @@index([category], map: "idx_state_region_category")
  @@index([country_code2], map: "idx_state_region_country")
  @@index([parent_code], map: "idx_state_region_parent")
  @@schema("ref")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model timezone {
  tzid           String     @id
  display_name   String?
  utc_offset     String?
  is_alias       Boolean    @default(false)
  canonical_tzid String?
  status         String     @default("active")
  metadata       Json       @default("{}")
  created_at     DateTime   @default(now()) @db.Timestamptz(6)
  created_by     String     @default("seed")
  updated_at     DateTime?  @db.Timestamptz(6)
  updated_by     String?
  timezone       timezone?  @relation("timezoneTotimezone", fields: [canonical_tzid], references: [tzid], onDelete: NoAction, onUpdate: NoAction)
  other_timezone timezone[] @relation("timezoneTotimezone")

  @@index([canonical_tzid], map: "idx_timezone_canonical")
  @@schema("ref")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model uom {
  code          String    @id
  name          String
  symbol        String?
  quantity_type String?
  status        String    @default("active")
  metadata      Json      @default("{}")
  created_at    DateTime  @default(now()) @db.Timestamptz(6)
  created_by    String    @default("seed")
  updated_at    DateTime? @db.Timestamptz(6)
  updated_by    String?

  @@schema("ref")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model dashboard_widget {
  id           String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id    String    @db.Uuid
  principal_id String    @db.Uuid
  widget_type  String
  widget_name  String?
  description  String?
  position     Json      @default("{\"h\": 3, \"w\": 4, \"x\": 0, \"y\": 0}")
  config       Json?
  data_source  Json?
  is_visible   Boolean   @default(true)
  created_at   DateTime  @default(now()) @db.Timestamptz(6)
  created_by   String
  updated_at   DateTime? @db.Timestamptz(6)
  updated_by   String?
  principal    Principal @relation(fields: [principal_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenant       Tenant    @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([principal_id], map: "idx_dashboard_widget_principal")
  @@index([widget_type], map: "idx_dashboard_widget_type")
  @@schema("ui")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model notification {
  id                                             String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id                                      String     @db.Uuid
  recipient_id                                   String     @db.Uuid
  sender_id                                      String?    @db.Uuid
  channel                                        String     @default("in_app")
  category                                       String?
  priority                                       String     @default("normal")
  title                                          String
  body                                           String?
  icon                                           String?
  action_url                                     String?
  entity_type                                    String?
  entity_id                                      String?    @db.Uuid
  is_read                                        Boolean    @default(false)
  read_at                                        DateTime?  @db.Timestamptz(6)
  is_dismissed                                   Boolean    @default(false)
  dismissed_at                                   DateTime?  @db.Timestamptz(6)
  expires_at                                     DateTime?  @db.Timestamptz(6)
  metadata                                       Json?
  created_at                                     DateTime   @default(now()) @db.Timestamptz(6)
  created_by                                     String
  principal_notification_recipient_idToprincipal Principal  @relation("notification_recipient_idToprincipal", fields: [recipient_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  principal_notification_sender_idToprincipal    Principal? @relation("notification_sender_idToprincipal", fields: [sender_id], references: [id], onUpdate: NoAction)
  tenant                                         Tenant     @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([tenant_id, entity_type, entity_id], map: "idx_notification_entity")
  @@index([tenant_id, recipient_id, created_at(sort: Desc)], map: "idx_notification_recipient_time")
  @@schema("ui")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model notification_preference {
  id           String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id    String    @db.Uuid
  principal_id String    @db.Uuid
  event_code   String
  channel      String
  is_enabled   Boolean   @default(true)
  frequency    String    @default("immediate")
  quiet_hours  Json?
  metadata     Json?
  created_at   DateTime  @default(now()) @db.Timestamptz(6)
  created_by   String
  updated_at   DateTime? @db.Timestamptz(6)
  updated_by   String?
  principal    Principal @relation(fields: [principal_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenant       Tenant    @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([principal_id, event_code, channel], map: "notification_preference_principal_event_channel_uniq")
  @@index([event_code, channel], map: "idx_notification_preference_event")
  @@index([principal_id], map: "idx_notification_preference_principal")
  @@schema("ui")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model recent_activity {
  id           String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id    String    @db.Uuid
  principal_id String    @db.Uuid
  entity_type  String
  entity_id    String    @db.Uuid
  entity_name  String?
  action       String    @default("view")
  accessed_at  DateTime  @default(now()) @db.Timestamptz(6)
  metadata     Json?
  created_at   DateTime  @default(now()) @db.Timestamptz(6)
  principal    Principal @relation(fields: [principal_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenant       Tenant    @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([tenant_id, entity_type, entity_id], map: "idx_recent_activity_entity")
  @@index([principal_id, accessed_at(sort: Desc)], map: "idx_recent_activity_principal_time")
  @@schema("ui")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model saved_view {
  id           String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id    String    @db.Uuid
  principal_id String    @db.Uuid
  entity_type  String
  view_name    String
  description  String?
  is_default   Boolean   @default(false)
  is_shared    Boolean   @default(false)
  filters      Json?
  sort_order   Json?
  columns      Json?
  group_by     Json?
  metadata     Json?
  created_at   DateTime  @default(now()) @db.Timestamptz(6)
  created_by   String
  updated_at   DateTime? @db.Timestamptz(6)
  updated_by   String?
  principal    Principal @relation(fields: [principal_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenant       Tenant    @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([principal_id, entity_type], map: "idx_saved_view_principal_entity")
  @@schema("ui")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model search_history {
  id           String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id    String    @db.Uuid
  principal_id String    @db.Uuid
  query_text   String
  entity_type  String?
  result_count Int?
  searched_at  DateTime  @default(now()) @db.Timestamptz(6)
  created_at   DateTime  @default(now()) @db.Timestamptz(6)
  principal    Principal @relation(fields: [principal_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenant       Tenant    @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([principal_id, searched_at(sort: Desc)], map: "idx_search_history_principal_time")
  @@schema("ui")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model user_preference {
  id               String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id        String    @db.Uuid
  principal_id     String    @db.Uuid
  preference_key   String
  preference_value Json
  created_at       DateTime  @default(now()) @db.Timestamptz(6)
  created_by       String
  updated_at       DateTime? @db.Timestamptz(6)
  updated_by       String?
  principal        Principal @relation(fields: [principal_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenant           Tenant    @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([principal_id, preference_key], map: "user_preference_principal_key_uniq")
  @@index([principal_id], map: "idx_user_preference_principal")
  @@schema("ui")
}
