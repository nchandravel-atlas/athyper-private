# =======================================================================
# athyper Runtime â€“ Development Dockerfile
# Usage:
#   Built by docker compose via mesh/compose/apps/mesh-athyper.yml
#   Build context: monorepo root (../.. from mesh/compose project-dir)
#
# Rebuild after dependency or source changes:
#   docker compose --project-directory mesh/compose build athyper-api
# =======================================================================

FROM node:22-alpine

RUN npm install -g pnpm@10

WORKDIR /app

COPY . .

RUN pnpm install --frozen-lockfile

# Build workspace dependencies that export from dist/
# Explicit list avoids pulling in product apps (e.g. @neon/web) via transitive deps
RUN pnpm --filter "@athyper/core" \
         --filter "@athyper/adapter-*" \
         --filter "@athyper/dashboard" \
         build

EXPOSE 3000

CMD ["pnpm", "--filter", "@athyper/runtime", "start:dev"]
