# =============================================
# athyper MESH - Environment Configuration
# =============================================

# =============================================
# ENVIRONMENT IDENTITY
# =============================================
# Valid values: local | staging | production
ENVIRONMENT=staging
COMPOSE_PROJECT_NAME=athyper-mesh-staging

# =============================================
# RUNTIME CONFIGURATION
# =============================================
MODE=api
MULTITENANT=TRUE
SERVICE_NAME=athyper-runtime
SERVICE_VERSION=1.0.0
PORT=3000
LOG_LEVEL=info
SHUTDOWN_TIMEOUT_MS=30000

# =============================================
# PUBLIC URLs
# =============================================
PUBLIC_BASE_URL=https://api-stg.athyper.com
PUBLIC_WEB_URL=https://neon-stg.athyper.com

# =============================================
# BASE PATHS
# =============================================
MESH_DATA=/var/lib/athyper/mesh/data
MESH_CONFIG=/etc/athyper/mesh/config
ATHYPER_KERNEL_CONFIG_PATH=apps/athyper/kernel.config.staging.parameter.json
AUTH_DEBUG_EXPOSE_TOKENS=true
# =============================================
# HOSTNAMES
# =============================================
# Gateway & Infrastructure
GATEWAY_HOST=gateway.mesh-stg.athyper.com
IAM_HOST=iam.mesh-stg.athyper.com
OBJECTSTORAGE_HOST=objectstorage.mesh-stg.athyper.com
OBJECTSTORAGE_CONSOLE_HOST=objectstorage.console.mesh-stg.athyper.com

# Observability
TELEMETRY_HOST=telemetry.mesh-stg.athyper.com
METRICS_HOST=metrics.mesh-stg.athyper.com
TRACES_HOST=traces.mesh-stg.athyper.com
LOGS_HOST=logs.mesh-stg.athyper.com

# Applications
APPS_ATHYPER_WEB_HOST=neon-stg.athyper.com
APPS_ATHYPER_API_HOST=api-stg.athyper.com

# =============================================
# GATEWAY (Traefik)
# =============================================
GATEWAY_TLS_OPTIONS=mesh-gateway-tls12@file
DASHBOARD_AUTH_MW=mesh-dashboard-auth@file
GATEWAY_ACCESSLOG=true
GATEWAY_LOG_LEVEL=INFO

# =============================================
# SERVICE MEMORY LIMITS
# =============================================
GATEWAY_MEMORY_LIMIT=256m
IAM_MEMORY_LIMIT=1g
OBJECTSTORAGE_MEMORY_LIMIT=512m
MEMORYCACHE_MEMORY_LIMIT=256m
MEMORYCACHE_EXPORTER_MEMORY_LIMIT=64m
TELEMETRY_MEMORY_LIMIT=512m
METRICS_MEMORY_LIMIT=512m
TRACING_MEMORY_LIMIT=512m
LOGGING_MEMORY_LIMIT=512m
LOGSHIPPER_MEMORY_LIMIT=128m
APPS_ATHYPER_MEMORY_LIMIT=512m

# =============================================
# DATABASE (PostgreSQL via PgBouncer)
# =============================================
DATABASE_URL=postgresql://athyper_user:${DB_PASSWORD}@mesh.dbpool.atlasdigitaltech.com:6432/athyper_test1
DATABASE_ADMIN_URL=postgresql://athyper_user:${DB_ADMIN_PASSWORD}@mesh.dbpool.atlasdigitaltech.com:5432/athyper_test1
DB_POOL_MAX=20

# =============================================
# CACHE (Redis)
# =============================================
REDIS_URL=redis://:${REDIS_PASSWORD}@redis-staging.athyper.io:6379/0
MEMORYCACHE_PASSWORD=${REDIS_PASSWORD}

# =============================================
# OBJECT STORAGE (MinIO S3)
# S3_ACCESS_KEY/S3_SECRET_KEY are also used as
# MinIO root credentials in the objectstorage container
# =============================================
S3_ENDPOINT=https://s3.staging.athyper.io
S3_ACCESS_KEY=${S3_ACCESS_KEY}
S3_SECRET_KEY=${S3_SECRET_KEY}
S3_REGION=us-east-1
S3_BUCKET=athyper-staging
S3_USE_SSL=true

# =============================================
# IAM (Keycloak)
# =============================================
IAM_ADMIN=${IAM_ADMIN_USER}
IAM_ADMIN_PASSWORD=${IAM_ADMIN_PASSWORD}
IAM_DB_URL=jdbc:postgresql://mesh.dbpool.atlasdigitaltech.com:6433/athyperauth_test1?preferQueryMode=simple
IAM_DB_USERNAME=athyperauthdb_user
IAM_DB_PASSWORD=${IAM_DB_PASSWORD}
IAM_ISSUER_URL=https://iam.mesh-stg.athyper.com/realms/athyper
IAM_CLIENT_ID=athyper-api
IAM_CLIENT_SECRET=${IAM_CLIENT_SECRET}

# =============================================
# IAM SECRETS (SUPERSTAR env vars)
# =============================================
# These are resolved by kernel config loader
ATHYPER_SUPER__IAM_SECRET__IAM_ATHYPER_CLIENT_SECRET=${IAM_CLIENT_SECRET}

# =============================================
# TELEMETRY
# =============================================
OTLP_ENDPOINT=http://logshipper:4318
TELEMETRY_ADMIN_USER=${GRAFANA_ADMIN_USER}
TELEMETRY_ADMIN_PASSWORD=${GRAFANA_ADMIN_PASSWORD}
